



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>数据安全详解 - LeanCloud 文档</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/mdc-web.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#acl" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="LeanCloud 文档" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                LeanCloud 文档
              </span>
              <span class="md-header-nav__topic">
                数据安全详解
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="文档首页" class="md-tabs__link">
        文档首页
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../storage-overview/" title="数据存储" class="md-tabs__link md-tabs__link--active">
          数据存储
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../engine/engine-overview/" title="云引擎+云缓存" class="md-tabs__link">
          云引擎+云缓存
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../im/im-overview/" title="即时通讯" class="md-tabs__link">
          即时通讯
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../push/push-overview/" title="消息推送" class="md-tabs__link">
          消息推送
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../sms/sms-overview/" title="短信" class="md-tabs__link">
          短信
        </a>
      
    </li>
  

      
        
  
  
    
    
  
  
    <li class="md-tabs__item">
      
        <a href="../../game/play/play-overview/" title="游戏+云端" class="md-tabs__link">
          游戏+云端
        </a>
      
    </li>
  

  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../solution/weapp/" title="微信小程序" class="md-tabs__link">
          微信小程序
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="LeanCloud 文档" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    LeanCloud 文档
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="文档首页" class="md-nav__link">
      文档首页
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      数据存储
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        数据存储
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../storage-overview/" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../object.md" title="对象存储与查询" class="md-nav__link">
      对象存储与查询
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user.md" title="用户管理" class="md-nav__link">
      用户管理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../live-query.md" title="实时数据同步 LiveQuery" class="md-nav__link">
      实时数据同步 LiveQuery
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        数据安全详解
      </label>
    
    <a href="./" title="数据安全详解" class="md-nav__link md-nav__link--active">
      数据安全详解
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acl_1" title="云引擎使用 ACL" class="md-nav__link">
    云引擎使用 ACL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" title="基于用户的权限管理" class="md-nav__link">
    基于用户的权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="单用户权限设置" class="md-nav__link">
    单用户权限设置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="多用户权限设置" class="md-nav__link">
    多用户权限设置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="局限性" class="md-nav__link">
    局限性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="基于角色的权限管理" class="md-nav__link">
    基于角色的权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acl_2" title="ACL 权限管理" class="md-nav__link">
    ACL 权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="默认权限" class="md-nav__link">
    默认权限
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="角色的权限管理" class="md-nav__link">
    角色的权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" title="角色的创建" class="md-nav__link">
    角色的创建
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-acl" title="Role 对象自身的 ACL" class="md-nav__link">
    Role 对象自身的 ACL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="为对象设置角色的访问权限" class="md-nav__link">
    为对象设置角色的访问权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="用户角色的赋予和剥夺" class="md-nav__link">
    用户角色的赋予和剥夺
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="角色的查询" class="md-nav__link">
    角色的查询
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="角色的从属关系" class="md-nav__link">
    角色的从属关系
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="权限的分级" class="md-nav__link">
    权限的分级
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-object-acl" title="表 Class 和对象 Object 的 ACL 组合" class="md-nav__link">
    表 Class 和对象 Object 的 ACL 组合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acl_3" title="获取对象的 ACL 值" class="md-nav__link">
    获取对象的 ACL 值
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="超级权限" class="md-nav__link">
    超级权限
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" title="最佳实践" class="md-nav__link">
    最佳实践
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      云引擎+云缓存
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        云引擎+云缓存
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/engine-overview/" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/start.md" title="快速入门" class="md-nav__link">
      快速入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      网站托管
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        网站托管
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/nodejs.md" title="NodeJS" class="md-nav__link">
      NodeJS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/python.md" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/php.md" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/dotnet.md" title="C#" class="md-nav__link">
      C#
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      云函数
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        云函数
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/storage-hook.md" title="数据存储 Hook" class="md-nav__link">
      数据存储 Hook
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/im-hook.md" title="即时通讯 Hook" class="md-nav__link">
      即时通讯 Hook
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/leancache.md" title="云缓存 LeanCache 使用指南" class="md-nav__link">
      云缓存 LeanCache 使用指南
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/faq.md" title="云引擎常见问题" class="md-nav__link">
      云引擎常见问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lean-cli.md" title="命令行工具 CLI 使用指南" class="md-nav__link">
      命令行工具 CLI 使用指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      即时通讯
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        即时通讯
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../im/im-overview/" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      客户端开发指南
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        客户端开发指南
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../im/im-beginner/" title="基础入门" class="md-nav__link">
      基础入门
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../im/im-intermediate.md" title="进阶功能" class="md-nav__link">
      进阶功能
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../im/im-senior.md" title="高阶技巧" class="md-nav__link">
      高阶技巧
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      服务端开发指南
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        服务端开发指南
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3-1" type="checkbox" id="nav-4-3-1">
    
    <label class="md-nav__link" for="nav-4-3-1">
      Hook
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-3-1">
        Hook
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/hook-nodejs.md" title="NodeJS" class="md-nav__link">
      NodeJS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/hook-python.md" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/hook-php.md" title="PHP" class="md-nav__link">
      PHP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/hook-dotnet.md" title="C#" class="md-nav__link">
      C#
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3-2" type="checkbox" id="nav-4-3-2">
    
    <label class="md-nav__link" for="nav-4-3-2">
      管理开发指南
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-4-3-2">
        管理开发指南
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../engine/server-python.md" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      消息推送
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        消息推送
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../push/push-overview/" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      开发指南
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        开发指南
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2-1" type="checkbox" id="nav-5-2-1">
    
    <label class="md-nav__link" for="nav-5-2-1">
      iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2-1">
        iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../push/apns-cert/" title="APNS 证书配置" class="md-nav__link">
      APNS 证书配置
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2-2" type="checkbox" id="nav-5-2-2">
    
    <label class="md-nav__link" for="nav-5-2-2">
      Android
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-5-2-2">
        Android
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../push/android-mixpush/" title="Android 混合推送" class="md-nav__link">
      Android 混合推送
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      短信
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        短信
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sms/sms-overview/" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6-2" type="checkbox" id="nav-6-2">
    
    <label class="md-nav__link" for="nav-6-2">
      开发指南
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-6-2">
        开发指南
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../sms/marketing/" title="营销短信" class="md-nav__link">
      营销短信
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sms/notice/" title="通知短信" class="md-nav__link">
      通知短信
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../sms/user/" title="用户验证类短信" class="md-nav__link">
      用户验证类短信
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      游戏+云端
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        游戏+云端
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1">
    
    <label class="md-nav__link" for="nav-7-1">
      多人实时对战
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        多人实时对战
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../game/play/play-overview/" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../game/play/multiplayer/" title="开发指南" class="md-nav__link">
      开发指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      排行榜
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        排行榜
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../game/leaderboard/leaderboard-overview.md" title="服务总览" class="md-nav__link">
      服务总览
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../game/leaderboard/leaderboard.md" title="开发指南" class="md-nav__link">
      开发指南
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      微信小程序
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        微信小程序
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../solution/weapp/" title="在微信小程序与小游戏中使用 LeanCloud" class="md-nav__link">
      在微信小程序与小游戏中使用 LeanCloud
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acl_1" title="云引擎使用 ACL" class="md-nav__link">
    云引擎使用 ACL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" title="基于用户的权限管理" class="md-nav__link">
    基于用户的权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" title="单用户权限设置" class="md-nav__link">
    单用户权限设置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" title="多用户权限设置" class="md-nav__link">
    多用户权限设置
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" title="局限性" class="md-nav__link">
    局限性
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="基于角色的权限管理" class="md-nav__link">
    基于角色的权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acl_2" title="ACL 权限管理" class="md-nav__link">
    ACL 权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" title="默认权限" class="md-nav__link">
    默认权限
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" title="角色的权限管理" class="md-nav__link">
    角色的权限管理
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" title="角色的创建" class="md-nav__link">
    角色的创建
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#role-acl" title="Role 对象自身的 ACL" class="md-nav__link">
    Role 对象自身的 ACL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" title="为对象设置角色的访问权限" class="md-nav__link">
    为对象设置角色的访问权限
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" title="用户角色的赋予和剥夺" class="md-nav__link">
    用户角色的赋予和剥夺
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" title="角色的查询" class="md-nav__link">
    角色的查询
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" title="角色的从属关系" class="md-nav__link">
    角色的从属关系
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" title="权限的分级" class="md-nav__link">
    权限的分级
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-object-acl" title="表 Class 和对象 Object 的 ACL 组合" class="md-nav__link">
    表 Class 和对象 Object 的 ACL 组合
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acl_3" title="获取对象的 ACL 值" class="md-nav__link">
    获取对象的 ACL 值
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" title="超级权限" class="md-nav__link">
    超级权限
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" title="最佳实践" class="md-nav__link">
    最佳实践
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="acl">ACL 权限管理开发指南<a class="headerlink" href="#acl" title="Permanent link">&para;</a></h1>
<p>ACL 是 Access Control List 的缩写，称为访问控制列表，包含了对一个对象或一条记录可进行何种操作的权限定义。例如一个文件对象的 ACL 为 <code class="codehilite"><span class="n">Alice</span><span class="o">:</span> <span class="n">read</span><span class="o">,</span><span class="n">write</span><span class="o">;</span> <span class="n">Bob</span><span class="o">:</span> <span class="n">read</span></code>，这代表 Alice 对该文件既能读又能写，而 Bob 只能读取。</p>
<p>LeanCloud 云端使用的 ACL 机制是将每个操作授权给特定的 User 用户或者 Role 角色，只允许这些用户或角色对一个对象执行这些操作。例如如下 ACL 定义：</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;*&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">false</span>
  <span class="p">},</span>
  <span class="nt">&quot;role:admin&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">},</span>
  <span class="nt">&quot;58113fbda0bb9f0061ddc869&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<ul>
<li>所有人可读，但不能写（<code class="codehilite">*</code> 代表所有人）。</li>
<li>角色为 admin 的用户及子角色，可读可写。</li>
<li>ID 为 58113fbda0bb9f0061ddc869 的用户，可读可写。 </li>
</ul>
<p>LeanCloud 使用内建数据表 <code class="codehilite">_User</code> 来维护 <a href="leanstorage_guide-js.html#用户">用户/账户系统</a>，和内建数据表 <code class="codehilite">_Role</code> 来维护 <a href="leanstorage_guide-js.html#角色">角色</a>。角色既可以包含用户，也可以包含其他角色，也就是说角色有层次关系，将权限授予一个角色代表该角色所包含的其他角色也会得到相应的权限。</p>
<p>LeanCloud 云端对客户端发过来的每一个请求都要进行了用户身份鉴别和 ACL 访问授权的严格检查。因此，使用 ACL 可以灵活且最大程度地保护应用数据，提升访问安全。详细背景及原因请参考 <a href="acl-start.html">ACL 与数据安全</a>。</p>
<p>下面使用一个极简的论坛的场景来举例：用户只能修改或者删除自己发的帖子，其他用户则只能查看。</p>
<h2 id="acl_1">云引擎使用 ACL<a class="headerlink" href="#acl_1" title="Permanent link">&para;</a></h2>
<p>文档中使用的 <code class="codehilite">AV.User.current()</code> 这个方法仅仅针对浏览器端有效，在<strong>云引擎中该接口无法使用</strong>。云引擎中获取用户信息，请参考 <a href="leanengine_webhosting_guide-node.html#处理用户登录和登出">云引擎指南 &middot; 处理用户登录和登出</a>。</p>
<h2 id="_1">基于用户的权限管理<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h3 id="_2">单用户权限设置<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>以上需求在 LeanCloud 中实现的步骤如下：</p>
<ol>
<li>写一篇帖子</li>
<li>设置帖子的「读」权限为所有人可读</li>
<li>设置帖子的「写」权限为作者可写</li>
<li>保存帖子</li>
</ol>
<p>实例代码如下：</p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 新建一个帖子对象</span>
    <span class="n">AVObject</span> <span class="o">*</span><span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVObject</span> <span class="nl">objectWithClassName</span><span class="p">:</span><span class="s">@&quot;Post&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">post</span> <span class="nl">setObject</span><span class="p">:</span><span class="s">@&quot;大家好，我是新人&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;title&quot;</span><span class="p">];</span>
    
    <span class="c1">//新建一个 ACL 实例</span>
    <span class="n">AVACL</span> <span class="o">*</span><span class="n">acl</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
    <span class="p">[</span><span class="n">acl</span> <span class="nl">setPublicReadAccess</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span><span class="c1">// 设置公开的「读」权限，任何人都可阅读</span>
    <span class="p">[</span><span class="n">acl</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forUser</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span><span class="c1">// 为当前用户赋予「写」权限，有且仅有当前用户可以修改这条 Post</span>
    <span class="n">post</span><span class="p">.</span><span class="n">ACL</span> <span class="o">=</span> <span class="n">acl</span><span class="p">;</span><span class="c1">// 将 ACL 实例赋予 Post对象</span>
    
    <span class="p">[</span><span class="n">post</span> <span class="n">saveInBackground</span><span class="p">];</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">post</span> <span class="p">=</span> <span class="n">AVObject</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>
    <span class="n">post</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;大家好，我是新人&quot;</span>

    <span class="kd">let</span> <span class="nv">acl</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

    <span class="n">acl</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

    <span class="k">if</span> <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">acl</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">currentUser</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">post</span><span class="p">.</span><span class="n">acl</span> <span class="p">=</span> <span class="n">acl</span>

    <span class="n">post</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_2" />
<label for="__tab_1_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="n">AVObject</span> <span class="n">post</span><span class="o">=</span><span class="k">new</span> <span class="n">AVObject</span><span class="o">(</span><span class="s">&quot;Post&quot;</span><span class="o">);</span>
  <span class="n">post</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span><span class="s">&quot;大家好，我是新人&quot;</span><span class="o">);</span>
  
  <span class="c1">//新建一个 ACL 实例</span>
  <span class="n">AVACL</span> <span class="n">acl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
  <span class="n">acl</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">// 设置公开的「读」权限，任何人都可阅读</span>
  <span class="n">acl</span><span class="o">.</span><span class="na">setWriteAccess</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">(),</span> <span class="kc">true</span><span class="o">);</span><span class="c1">// 为当前用户赋予「写」权限，有且仅有当前用户可以修改这条 Post</span>
  
  
  <span class="n">post</span><span class="o">.</span><span class="na">setACL</span><span class="o">(</span><span class="n">acl</span><span class="o">);</span><span class="c1">// 将 ACL 实例赋予 Post对象</span>
  <span class="n">post</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span><span class="c1">// 保存</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_3" />
<label for="__tab_1_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 新建一个帖子对象</span>
  <span class="kd">var</span> <span class="nx">Post</span> <span class="o">=</span> <span class="nx">AV</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">();</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;大家好，我是新人&#39;</span><span class="p">);</span>

  <span class="c1">// 新建一个 ACL 实例</span>
  <span class="kd">var</span> <span class="nx">acl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
  <span class="nx">acl</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="nx">acl</span><span class="p">.</span><span class="nx">setWriteAccess</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">(),</span><span class="kc">true</span><span class="p">);</span>

  <span class="c1">// 将 ACL 实例赋予 Post 对象</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">setACL</span><span class="p">(</span><span class="nx">acl</span><span class="p">);</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 保存成功</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_4" />
<label for="__tab_1_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="c1"># 新建一个帖子对象</span>
<span class="n">Post</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="n">post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;大家好，我是新人&#39;</span><span class="p">)</span>

<span class="c1"># 新建一个leancloud.ACL实例</span>
<span class="n">acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">()</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_public_read_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># 这里设置某个 user 的写权限</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_write_access</span><span class="p">(</span><span class="s1">&#39;user_objectId&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># 将 leancloud.ACL 实例赋予 Post 对象</span>
<span class="n">post</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">acl</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
</div>
<p>以上代码产生的效果在 <strong>控制台</strong> &gt; <strong>存储</strong> &gt; <strong>Post 表</strong> 可以看到，这条记录的 ACL 列上的值为：</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>  
  <span class="nt">&quot;*&quot;</span><span class="p">:{</span>  
    <span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">},</span>
  <span class="nt">&quot;55b9df0400b0f6d7efaa8801&quot;</span><span class="p">:{</span>  
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>此时，这种 ACL 值的表示：所有用户均有「读」权限，而 <code class="codehilite">objectId</code> 为 <code class="codehilite">55b9df0400b0f6d7efaa8801</code> 拥有「写」权限，其他用户不具备「写」权限。</p>
<h3 id="_3">多用户权限设置<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>假如需求增加为：帖子的作者允许某个特定的用户可以修改帖子，除此之外的其他人不可修改。
实现步骤就是额外指定一个用户，为他设置帖子的「写」权限：</p>
<div class="admonition note">
<p class="admonition-title">注意</p>
<p><strong>开启 <code class="codehilite">_User</code> 表的查询权限</strong>才可以执行以下代码。</p>
</div>
<div class="superfences-tabs">
<input name="__tabs_2" type="radio" id="__tab_2_0" checked="checked" />
<label for="__tab_2_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">query</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVUser</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">query</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;objectId&quot;</span> <span class="nl">equalTo</span><span class="p">:</span><span class="s">@&quot;55f1572460b2ce30e8b7afde&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">query</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">error</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 新建一个帖子对象</span>
            <span class="n">AVObject</span> <span class="o">*</span><span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVObject</span> <span class="nl">objectWithClassName</span><span class="p">:</span><span class="s">@&quot;Post&quot;</span><span class="p">];</span>
            <span class="p">[</span><span class="n">post</span> <span class="nl">setObject</span><span class="p">:</span><span class="s">@&quot;这是我的第二条发言，谢谢大家！&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;title&quot;</span><span class="p">];</span>
            <span class="p">[</span><span class="n">post</span> <span class="nl">setObject</span><span class="p">:</span><span class="s">@&quot;我最近喜欢看足球和篮球了。&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;content&quot;</span><span class="p">];</span>
            
            <span class="c1">//新建一个 ACL 实例</span>
            <span class="n">AVACL</span> <span class="o">*</span><span class="n">acl</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
            <span class="p">[</span><span class="n">acl</span> <span class="nl">setPublicReadAccess</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span><span class="c1">// 设置公开的「读」权限，任何人都可阅读</span>
            <span class="p">[</span><span class="n">acl</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forUser</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span><span class="c1">// 为当前用户赋予「写」权限</span>
            
            <span class="n">AVUser</span> <span class="o">*</span><span class="n">otherUser</span> <span class="o">=</span> <span class="p">[</span><span class="n">objects</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span><span class="c1">// 读取 admin</span>
            <span class="p">[</span><span class="n">acl</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forUser</span><span class="p">:</span><span class="n">otherUser</span><span class="p">];</span>
            
            <span class="n">post</span><span class="p">.</span><span class="n">ACL</span> <span class="o">=</span> <span class="n">acl</span><span class="p">;</span><span class="c1">// 将 ACL 实例赋予 Post 对象</span>
            
            <span class="p">[</span><span class="n">post</span> <span class="n">saveInBackground</span><span class="p">];</span>
            
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;error&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_1" />
<label for="__tab_2_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">query</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">query</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;objectId&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="s">&quot;55f1572460b2ce30e8b7afde&quot;</span><span class="p">)</span>

    <span class="n">query</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">post</span> <span class="p">=</span> <span class="n">AVObject</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>

            <span class="n">post</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;这是我的第二条发言，谢谢大家！&quot;</span>
            <span class="n">post</span><span class="p">[</span><span class="s">&quot;content&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;我最近喜欢看足球和篮球了。&quot;</span>

            <span class="kd">let</span> <span class="nv">acl</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

            <span class="c1">// Anyone can read this post.</span>
            <span class="n">acl</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

            <span class="c1">// Current user and another user can manage this post.</span>
            <span class="k">if</span> <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">acl</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">currentUser</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="kd">let</span> <span class="nv">anotherUser</span> <span class="p">=</span> <span class="n">objects</span><span class="p">?.</span><span class="bp">first</span> <span class="k">as</span><span class="p">?</span> <span class="n">AVUser</span> <span class="p">{</span>
                <span class="n">acl</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">anotherUser</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">post</span><span class="p">.</span><span class="n">acl</span> <span class="p">=</span> <span class="n">acl</span>

            <span class="n">post</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_2" />
<label for="__tab_2_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">AVUser</span><span class="o">.</span><span class="na">getQuery</span><span class="o">();</span>
  <span class="n">query</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;objectId&quot;</span><span class="o">,</span><span class="s">&quot;55f1572460b2ce30e8b7afde&quot;</span><span class="o">);</span>
  <span class="n">query</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">e</span> <span class="o">==</span> <span class="kc">null</span><span class="o">){</span>
        <span class="c1">// 新建一个帖子对象</span>
        <span class="n">AVObject</span> <span class="n">post</span><span class="o">=</span> <span class="k">new</span> <span class="n">AVObject</span><span class="o">(</span><span class="s">&quot;Post&quot;</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span><span class="s">&quot;这是我的第二条发言，谢谢大家！&quot;</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;content&quot;</span><span class="o">,</span><span class="s">&quot;我最近喜欢看足球和篮球了。&quot;</span><span class="o">);</span>

        <span class="c1">//新建一个 ACL 实例</span>
        <span class="n">AVACL</span> <span class="n">acl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
        <span class="n">acl</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">// 设置公开的「读」权限，任何人都可阅读</span>
        <span class="n">acl</span><span class="o">.</span><span class="na">setWriteAccess</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">(),</span> <span class="kc">true</span><span class="o">);</span><span class="c1">//为当前用户赋予「写」权限</span>

        <span class="c1">//注：此处为了简化展现代码，未做 list 为空的判断。</span>
        <span class="n">AVUser</span> <span class="n">anotherUser</span><span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">acl</span><span class="o">.</span><span class="na">setWriteAccess</span><span class="o">(</span><span class="n">anotherUser</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>

        <span class="c1">// 将 ACL 实例赋予 Post对象</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setACL</span><span class="o">(</span><span class="n">acl</span><span class="o">);</span>

        <span class="c1">//保存到云端</span>
        <span class="n">post</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="c1">// handle exception</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_3" />
<label for="__tab_2_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 创建一个针对 User 的查询</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">);</span>
  <span class="nx">query</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;55f1572460b2ce30e8b7afde&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">otherUser</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nb">Object</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">);</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;这是我的第二条发言，谢谢大家！&#39;</span><span class="p">);</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span><span class="s1">&#39;我最近喜欢看足球和篮球了。&#39;</span><span class="p">);</span>

    <span class="c1">// 新建一个 ACL 实例</span>
    <span class="kd">var</span> <span class="nx">acl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
    <span class="nx">acl</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">acl</span><span class="p">.</span><span class="nx">setWriteAccess</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
    <span class="nx">acl</span><span class="p">.</span><span class="nx">setWriteAccess</span><span class="p">(</span><span class="nx">otherUser</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="c1">// 将 ACL 实例赋予 Post 对象</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">setACL</span><span class="p">(</span><span class="nx">acl</span><span class="p">);</span>

    <span class="c1">// 保存到云端</span>
    <span class="k">return</span> <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 保存成功</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 错误信息</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_2" type="radio" id="__tab_2_4" />
<label for="__tab_2_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="c1"># 登录一个用户</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;my_user_name&#39;</span><span class="p">,</span> <span class="s1">&#39;my_password&#39;</span><span class="p">)</span>

<span class="c1"># 新建一个 Post 对象</span>
<span class="n">Post</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="n">post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;这是我的第二条发言，谢谢大家！&#39;</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;我最近喜欢看足球和篮球了。&#39;</span><span class="p">)</span>

<span class="c1"># 新建一个 leancloud.ACL 实例</span>
<span class="n">acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">()</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_public_read_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="c1"># 设置当前登录用户的的可写权限</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_write_access</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">()</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="c1"># 设定指定 objectId 用户的可写权限</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_write_access</span><span class="p">(</span><span class="s1">&#39;55f1572460b2ce30e8b7afde&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">acl</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
</div>
<p>执行完毕上面的代码，回到控制台，可以看到，该条 Post 记录里面的 ACL 列的内容如下：</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;*&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">},</span>
  <span class="nt">&quot;55b9df0400b0f6d7efaa8801&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">},</span>
  <span class="nt">&quot;55f1572460b2ce30e8b7afde&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>从结果可以看出，该条 Post 已经允许 Id 为 <code class="codehilite">55b9df0400b0f6d7efaa8801</code> 以及 <code class="codehilite">55f1572460b2ce30e8b7afde</code> 两个用户（AVUser）可以修改，他们拥有写权限 <code class="codehilite">&quot;write&quot;: ture</code>。</p>
<p>基于用户的权限管理比较简单直接，开发者理解起来成本较低。</p>
<h3 id="_4">局限性<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>接下来论坛要升级，需要一个特定的管理员 Administrator 来统一管理论坛的帖子，他可以修改帖子的内容，删除不合适的帖子。</p>
<p>论坛升级之后，用户发布帖子的步骤需要针对上一小节做如下调整：</p>
<ol>
<li>写一篇帖子</li>
<li>设置帖子的「读」权限为所有人。</li>
<li>设置帖子的「写」权限为作者以及管理员</li>
<li>保存帖子</li>
</ol>
<p>我们可以设想一下，每当论坛产生一篇帖子，就得为管理员添加这篇帖子的「写」权限。</p>
<p>假如做权限管理功能的时候都依赖基于用户的权限管理，那么一旦产生变化就会发现这种实现方式的局限性。</p>
<p>比如新增了一个管理员，新的管理员需要针对目前论坛所有的帖子拥有管理员应有的权限，那么我们需要把数据库现有的所有帖子循环一遍，为新的管理员增加「写」权限。</p>
<p>假如论坛又一次升级了，付费会员享有特殊帖子的读权限，那么我们需要在发布新帖子的时候，设置「读」权限给部分人（付费会员）。这需要查询所有付费会员并一一设置。</p>
<p>毫无疑问，这种实现方式是完全失控的，基于用户的权限管理，在针对简单的私密分享类的应用是可行的，但是一旦产生需求变更，这种实现方式是不被推荐的。</p>
<h2 id="_5">基于角色的权限管理<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>管理员、会员、普通用户这三种概念在程序设计中，被定义为「角色」。
我们可以看出，在列出的需求场景中，「权限」的作用是用来区分某一数据是否<strong>允许</strong>某种角色的用户进行操作。</p>
<p>{{ docs.note("「权限」只和「角色」对应，而用户也和「角色」对应，为用户赋予角色，然后管理角色的权限，完成了权限与用户的<strong>解耦</strong>。") }}</p>
<p>因此我们来解释 LeanCloud 中「权限」和「角色」的概念。</p>
<p>「权限」在 LeanCloud 服务端只存在两种权限：读、写。
「角色」在 LeanCloud 服务端没有限制，唯一要求的就是在一个应用内，角色的名字唯一即可，至于某一个「角色」在当前应用内对某条数据是否拥有读写的「权限」应该是有开发者的业务逻辑决定，而 LeanCloud 提供了一系列的接口帮助开发者快速实现基于角色的权限管理。</p>
<p>为了方便开发者实现基于角色的权限管理，LeanCloud 在 SDK 中集成了一套完整的 ACL (Access Control List) 系统。通俗的解释就是为每一个数据创建一个访问的白名单列表，只有在名单上的用户（AVUser）或者具有某种角色（AVRole）的用户才能被允许访问。</p>
<p>为了更好地保证用户数据安全性， LeanCloud 表中每一张都有一个 ACL 列。当然，LeanCloud 还提供了进一步的读写权限控制。</p>
<p>一个 User 必须拥有读权限（或者属于一个拥有读权限的 Role）才可以获取一个对象的数据，同时，一个 User 需要写权限（或者属于一个拥有写权限的 Role）才可以更改或者删除一个对象。下面列举几种常见的 ACL 使用范例。</p>
<h3 id="acl_2">ACL 权限管理<a class="headerlink" href="#acl_2" title="Permanent link">&para;</a></h3>
<h4 id="_6">默认权限<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>在没有显式指定的情况下，LeanCloud 中的每一个对象都会有一个默认的 ACL 值。这个值代表了所有的用户对这个对象都是可读可写的。此时你可以在数据管理的表中 ACL 属性中看到这样的值：</p>
<div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;*&quot;</span><span class="p">:{</span>
    <span class="nt">&quot;read&quot;</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span>
    <span class="nt">&quot;write&quot;</span><span class="p">:</span><span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p><a href="#基于用户的权限管理">基于用户的权限管理</a> 一节的代码已演示了通过 ACL 来实现基于用户的权限管理，那么基于角色的权限管理也是依赖 ACL 来实现的，只是在介绍详细的操作之前需要介绍「角色」这个重要的概念。</p>
<h3 id="_7">角色的权限管理<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<h4 id="_8">角色的创建<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h4>
<p>首先，我们来创建一个 <strong>Administrator</strong> 的角色。</p>
<p>这里有一个需要特别注意的地方，因为 <code class="codehilite">AVRole</code> 本身也是一个 <code class="codehilite">AVObject</code>，它自身也有 ACL 控制，并且它的权限控制应该更严谨，如同「论坛的管理员有权力任命版主，而版主无权任命管理员」一样的道理，所以创建角色的时候需要显式地设定该角色的 ACL，而角色是一种较为稳定的对象：</p>
<div class="superfences-tabs">
<input name="__tabs_3" type="radio" id="__tab_3_0" checked="checked" />
<label for="__tab_3_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 设定角色本身的 ACL </span>
    <span class="n">AVACL</span> <span class="o">*</span><span class="n">roleACL</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleACL</span> <span class="nl">setPublicReadAccess</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleACL</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forUser</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span>
    
    <span class="c1">// 创建角色，并且保存</span>
    <span class="n">AVRole</span> <span class="o">*</span><span class="n">administratorRole</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVRole</span> <span class="nl">roleWithName</span><span class="p">:</span><span class="s">@&quot;Administrator&quot;</span> <span class="nl">acl</span><span class="p">:</span><span class="n">roleACL</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">administratorRole</span> <span class="n">users</span><span class="p">]</span> <span class="nl">addObject</span><span class="p">:</span> <span class="p">[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span>
    <span class="p">[</span><span class="n">administratorRole</span> <span class="n">saveInBackground</span><span class="p">];</span>
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_1" />
<label for="__tab_3_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">roleACL</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

    <span class="n">roleACL</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

    <span class="k">if</span> <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">roleACL</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">currentUser</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nv">administratorRole</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;Administrator&quot;</span><span class="p">,</span> <span class="n">acl</span><span class="p">:</span> <span class="n">roleACL</span><span class="p">)</span>

    <span class="k">if</span> <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">administratorRole</span><span class="p">.</span><span class="n">users</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">currentUser</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">administratorRole</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_2" />
<label for="__tab_3_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 新建一个针对角色本身的 ACL</span>
  <span class="n">AVACL</span> <span class="n">roleACL</span><span class="o">=</span><span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
  <span class="n">roleACL</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
  <span class="n">roleACL</span><span class="o">.</span><span class="na">setWriteAccess</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">(),</span><span class="kc">true</span><span class="o">);</span>

  <span class="c1">// 新建一个角色，并把为当前用户赋予该角色</span>
  <span class="n">AVRole</span> <span class="n">administrator</span><span class="o">=</span> <span class="k">new</span> <span class="n">AVRole</span><span class="o">(</span><span class="s">&quot;Administrator&quot;</span><span class="o">,</span><span class="n">roleACL</span><span class="o">);</span><span class="c1">//新建角色</span>
  <span class="n">administrator</span><span class="o">.</span><span class="na">getUsers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">());</span><span class="c1">//为当前用户赋予该角色</span>
  <span class="n">administrator</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span><span class="c1">//保存到云端</span>
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_3" />
<label for="__tab_3_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 新建一个角色，并把为当前用户赋予该角色</span>
  <span class="kd">var</span> <span class="nx">roleAcl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
  <span class="nx">roleAcl</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
  <span class="nx">roleAcl</span><span class="p">.</span><span class="nx">setPublicWriteAccess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

  <span class="c1">// 当前用户是该角色的创建者，因此具备对该角色的写权限</span>
  <span class="nx">roleAcl</span><span class="p">.</span><span class="nx">setWriteAccess</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>

  <span class="c1">//新建角色</span>
  <span class="kd">var</span> <span class="nx">administratorRole</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Administrator&#39;</span><span class="p">,</span> <span class="nx">roleAcl</span><span class="p">);</span>
  <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">role</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 创建成功</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_3" type="radio" id="__tab_3_4" />
<label for="__tab_3_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>  <span class="c1"># 登录一个用户</span>

<span class="c1"># 新建一个角色，并把为当前用户赋予该角色</span>
<span class="n">administrator_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s1">&#39;Administrator&#39;</span><span class="p">)</span>
<span class="n">relation</span> <span class="o">=</span> <span class="n">administrator_role</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
<span class="n">relation</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>  <span class="c1"># 为当前用户赋予该角色</span>
<span class="n">administrator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># 保存</span>
</pre></div></div>
</div>
<p>执行完毕之后，在控制台可以查看 <code class="codehilite">_Role</code> 表里已经存在了一个 <strong>Administrator</strong> 角色。</p>
<h4 id="role-acl">Role 对象自身的 ACL<a class="headerlink" href="#role-acl" title="Permanent link">&para;</a></h4>
<p>在初始化一个 Oracle 或 MS SQL Server 数据库的时候，系统会自动创建一个 <code class="codehilite">sa</code> 用户，它具备操作当前数据库的全部权限，而其他人的权限理论上也应该由他来分配。
同理，我们在创建一个 Role 或者给某一个 User 分配 Role 的时候，也应该认为进行操作的当前用户本身就是具备较高权限的用户（类似于 sa）,因此在刚才创建角色的代码中会要求设置 Role 自身的 ACL 的值为当前用户可写，其他人仅可读。</p>
<p>另外需要开发者注意的是：可以直接通过 <strong>控制台</strong> &gt; <strong>Post 表</strong> &gt; <strong>其他</strong> &gt; <strong>权限设置</strong> 直接设置权限。并且我们要强调的是：</p>
<p>{{ docs.note("ACL 可以精确到 Class，也可以精确到具体的每一个对象（表中的每一条记录）。") }}</p>
<h4 id="_9">为对象设置角色的访问权限<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>我们现在已经创建了一个有效的角色，接下来为 <code class="codehilite">Post</code> 对象设置 <code class="codehilite">Administrator</code> 的访问「可读可写」的权限，设置成功以后，任何具备 <code class="codehilite">Administrator</code> 角色的用户都可以对 <code class="codehilite">Post</code> 对象进行「可读可写」的操作了：</p>
<div class="superfences-tabs">
<input name="__tabs_4" type="radio" id="__tab_4_0" checked="checked" />
<label for="__tab_4_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 新建一个帖子对象</span>
    <span class="n">AVObject</span> <span class="o">*</span><span class="n">post</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVObject</span> <span class="nl">objectWithClassName</span><span class="p">:</span><span class="s">@&quot;Post&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">post</span> <span class="nl">setObject</span><span class="p">:</span><span class="s">@&quot;夏天吃什么夜宵比较爽？&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;title&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">post</span> <span class="nl">setObject</span><span class="p">:</span><span class="s">@&quot;求推荐啊！&quot;</span> <span class="nl">forKey</span><span class="p">:</span><span class="s">@&quot;content&quot;</span><span class="p">];</span>
    
    
     <span class="c1">// 假设之前创建的 Administrator 角色 objectId 为 55fc0eb700b039e44440016c</span>
    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">roleQuery</span><span class="o">=</span> <span class="p">[</span><span class="n">AVRole</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">getObjectInBackgroundWithId</span><span class="p">:</span><span class="s">@&quot;55fc0eb700b039e44440016c&quot;</span> <span class="nl">block</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">AVObject</span> <span class="o">*</span><span class="n">object</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">AVRole</span> <span class="o">*</span><span class="n">administratorRole</span> <span class="o">=</span> <span class="p">(</span><span class="n">AVRole</span><span class="o">*</span><span class="p">)</span> <span class="n">object</span><span class="p">;</span>
        <span class="p">[</span><span class="n">administratorRole</span> <span class="nl">saveInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">succeeded</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//新建一个 ACL 实例</span>
            <span class="n">AVACL</span> <span class="o">*</span><span class="n">acl</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
            <span class="p">[</span><span class="n">acl</span> <span class="nl">setPublicReadAccess</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span><span class="c1">// 设置公开的「读」权限，任何人都可阅读</span>
            <span class="p">[</span><span class="n">acl</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span>  <span class="nl">forRole</span><span class="p">:</span><span class="n">administratorRole</span><span class="p">];</span><span class="c1">// 为 Administrator 「写」权限</span>
            <span class="p">[</span><span class="n">acl</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span>  <span class="nl">forUser</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span><span class="c1">// 为当前用户赋予「写」权限</span>
            <span class="n">post</span><span class="p">.</span><span class="n">ACL</span> <span class="o">=</span> <span class="n">acl</span><span class="p">;</span><span class="c1">// 将 ACL 实例赋予 Post对象</span>
            
            <span class="c1">// 以上代码的效果就是：只有 Post 作者（当前用户）和拥有 Administrator 角色的用户可以修改这条 Post，而所有人都可以读取这条 Post</span>
            <span class="p">[</span><span class="n">post</span> <span class="n">saveInBackground</span><span class="p">];</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_4" type="radio" id="__tab_4_1" />
<label for="__tab_4_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">roleQuery</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nv">post</span> <span class="p">=</span> <span class="n">AVObject</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>

    <span class="n">post</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;夏天吃什么夜宵比较爽？&quot;</span>
    <span class="n">post</span><span class="p">[</span><span class="s">&quot;content&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="s">&quot;求推荐啊！&quot;</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">getObjectInBackground</span><span class="p">(</span><span class="n">withId</span><span class="p">:</span> <span class="s">&quot;55fc0eb700b039e44440016c&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">object</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">administratorRole</span> <span class="p">=</span> <span class="n">object</span> <span class="k">as</span><span class="p">?</span> <span class="n">AVRole</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="kd">let</span> <span class="nv">acl</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

        <span class="n">acl</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="n">acl</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">administratorRole</span><span class="p">)</span>

        <span class="k">if</span> <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">acl</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">currentUser</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="n">post</span><span class="p">.</span><span class="n">acl</span> <span class="p">=</span> <span class="n">acl</span>

        <span class="n">post</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_4" type="radio" id="__tab_4_2" />
<label for="__tab_4_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 新建一个帖子对象</span>
  <span class="kd">final</span> <span class="n">AVObject</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVObject</span><span class="o">(</span><span class="s">&quot;Post&quot;</span><span class="o">);</span>
  <span class="n">post</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="s">&quot;夏天吃什么夜宵比较爽？&quot;</span><span class="o">);</span>
  <span class="n">post</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;content&quot;</span><span class="o">,</span> <span class="s">&quot;求推荐啊！&quot;</span><span class="o">);</span>

  <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">roleQuery</span><span class="o">=</span><span class="k">new</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;(</span><span class="s">&quot;_Role&quot;</span><span class="o">);</span>
  <span class="c1">// 假设上一步创建的 Administrator 角色的 objectId 为 55fc0eb700b039e44440016c</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">getInBackground</span><span class="o">(</span><span class="s">&quot;55fc0eb700b039e44440016c&quot;</span><span class="o">,</span> <span class="k">new</span> <span class="n">GetCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">AVRole</span> <span class="n">avRole</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">//新建一个 ACL 实例</span>
      <span class="n">AVACL</span> <span class="n">acl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
      <span class="n">acl</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span><span class="c1">// 设置公开的「读」权限，任何人都可阅读</span>
      <span class="n">acl</span><span class="o">.</span><span class="na">setRoleWriteAccess</span><span class="o">(</span><span class="n">avRole</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span><span class="c1">// 为 Administrator 「写」权限</span>
      <span class="n">acl</span><span class="o">.</span><span class="na">setWriteAccess</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">(),</span> <span class="kc">true</span><span class="o">);</span><span class="c1">// 为当前用户赋予「写」权限</span>

      <span class="c1">// 以上代码的效果就是：只有 Post 作者（当前用户）和拥有 Administrator 角色的用户可以修改这条 Post，而所有人都可以读取这条 Post</span>
      <span class="n">post</span><span class="o">.</span><span class="na">setACL</span><span class="o">(</span><span class="n">acl</span><span class="o">);</span>
      <span class="n">post</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_4" type="radio" id="__tab_4_3" />
<label for="__tab_4_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 新建一个帖子对象</span>
  <span class="kd">var</span> <span class="nx">Post</span> <span class="o">=</span> <span class="nx">AV</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">();</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;夏天吃什么夜宵比较爽？&#39;</span><span class="p">);</span>
  <span class="nx">post</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;求推荐啊！&#39;</span><span class="p">);</span>

  <span class="c1">// 新建一个角色，并把为当前用户赋予该角色</span>
  <span class="kd">var</span> <span class="nx">administratorRole</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Administrator&#39;</span><span class="p">);</span>

  <span class="kd">var</span> <span class="nx">relation</span> <span class="o">=</span> <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>

  <span class="c1">//为当前用户赋予该角色</span>
  <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>

  <span class="c1">//角色保存成功</span>
  <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">administratorRole</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 新建一个 ACL 实例</span>
    <span class="kd">var</span> <span class="nx">acl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
    <span class="nx">acl</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">acl</span><span class="p">.</span><span class="nx">setRoleWriteAccess</span><span class="p">(</span><span class="nx">administratorRole</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

    <span class="c1">// 将 ACL 实例赋予 Post 对象</span>
    <span class="nx">post</span><span class="p">.</span><span class="nx">setACL</span><span class="p">(</span><span class="nx">acl</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">post</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 保存成功</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 保存失败</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_4" type="radio" id="__tab_4_4" />
<label for="__tab_4_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="c1"># 登录一个用户</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>
<span class="c1"># 创建一个 Post 的帖子对象</span>
<span class="n">Post</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">)</span>
<span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="n">post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;夏天吃什么夜宵比较爽？&#39;</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="s1">&#39;求推荐啊！&#39;</span><span class="p">)</span>

<span class="c1"># 新建一个角色，并把当前用户赋予该角色</span>
<span class="n">administrator_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s1">&#39;Administrator&#39;</span><span class="p">)</span>
<span class="n">relation</span> <span class="o">=</span> <span class="n">administrator_role</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
<span class="n">relation</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
<span class="n">administrator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># 新建一个 leancloud.ACL 对象，并赋予角色可写权限</span>
<span class="n">acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">()</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_public_read_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">acl</span><span class="o">.</span><span class="n">set_role_write_access</span><span class="p">(</span><span class="n">administrator_role</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># 将 leancloud.ACL 实例赋予 Post 对象</span>
<span class="n">post</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">acl</span><span class="p">)</span>
<span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
</div>
<h4 id="_10">用户角色的赋予和剥夺<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>经过以上两步，我们还差一个给具体的用户设置角色的操作，这样才可以完整地实现基于角色的权限管理。</p>
<p>在通常情况下，角色和用户之间本是多对多的关系，比如需要把某一个用户提升为某一个版块的版主，亦或者某一个用户被剥夺了版主的权力，以此类推，在应用的版本迭代中，用户的角色都会存在增加或者减少的可能，因此，LeanCloud 也提供了为用户赋予或者剥夺角色的方式。</p>
<p>在代码级别，实现「为角色添加用户」与「为用户赋予角色」的代码是一样的。此类操作的逻辑顺序是：</p>
<ul>
<li>赋予角色：首先判断该用户是否已经被赋予该角色，如果已经存在则无需添加，如果不存在则为该用户(AVUser)的 <code class="codehilite"><span class="n">roles</span></code> 属性添加当前角色实例。</li>
</ul>
<p>以下代码演示为当前用户添加 <code class="codehilite">Administrator</code>角色：</p>
<div class="superfences-tabs">
<input name="__tabs_5" type="radio" id="__tab_5_0" checked="checked" />
<label for="__tab_5_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">roleQuery</span><span class="o">=</span> <span class="p">[</span><span class="n">AVRole</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;name&quot;</span> <span class="nl">equalTo</span><span class="p">:</span><span class="s">@&quot;Administrator&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 如果角色存在</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">objects</span> <span class="n">count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">AVRole</span> <span class="o">*</span><span class="n">administratorRole</span><span class="o">=</span> <span class="p">[</span><span class="n">objects</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;users&quot;</span> <span class="nl">equalTo</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span>
            <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">([</span><span class="n">objects</span> <span class="n">count</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">//为用户赋予角色</span>
                    <span class="p">[[</span><span class="n">administrator</span> <span class="n">users</span> <span class="p">]</span> <span class="nl">addObject</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span>
                    <span class="p">[</span><span class="n">administrator</span> <span class="n">saveInBackground</span><span class="p">];</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;已经拥有 Moderator 角色了。&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}];</span>
            
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// 角色不存在，就新建角色</span>
            <span class="n">AVRole</span> <span class="o">*</span><span class="n">administrator</span> <span class="o">=</span><span class="p">[</span><span class="n">AVRole</span> <span class="nl">roleWithName</span><span class="p">:</span><span class="s">@&quot;Administrator&quot;</span><span class="p">];</span>
            <span class="p">[[</span><span class="n">administrator</span> <span class="n">users</span> <span class="p">]</span> <span class="nl">addObject</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span><span class="c1">// 赋予角色</span>
            <span class="p">[</span><span class="n">administrator</span> <span class="n">saveInBackground</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_1" />
<label for="__tab_5_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">roleQuery</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="s">&quot;Administrator&quot;</span><span class="p">)</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="kd">let</span> <span class="nv">administrator</span> <span class="p">=</span> <span class="n">objects</span><span class="p">?.</span><span class="bp">first</span> <span class="k">as</span><span class="p">?</span> <span class="n">AVRole</span> <span class="p">{</span>
            <span class="n">roleQuery</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;users&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="n">currentUser</span><span class="p">)</span>

            <span class="n">roleQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="n">objects</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
                <span class="k">if</span> <span class="kd">let</span> <span class="nv">_</span> <span class="p">=</span> <span class="n">objects</span><span class="p">?.</span><span class="bp">first</span> <span class="k">as</span><span class="p">?</span> <span class="n">AVRole</span> <span class="p">{</span>
                    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Current user is already an administrator.&quot;</span><span class="p">)</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">administrator</span><span class="p">.</span><span class="n">users</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">currentUser</span><span class="p">)</span>
                    <span class="n">administrator</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">administrator</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="s">&quot;Administrator&quot;</span><span class="p">)</span>
            <span class="n">administrator</span><span class="p">.</span><span class="n">users</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">currentUser</span><span class="p">)</span>
            <span class="n">administrator</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_2" />
<label for="__tab_5_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="kd">final</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">roleQuery</span> <span class="o">=</span><span class="k">new</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;(</span><span class="s">&quot;_Role&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span><span class="s">&quot;Administrator&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// 如果角色存在</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
        <span class="kd">final</span> <span class="n">AVRole</span> <span class="n">administratorRole</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">roleQuery</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;users&quot;</span><span class="o">,</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">());</span>
        <span class="n">roleQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span>  <span class="o">==</span> <span class="mi">0</span><span class="o">){</span>
              <span class="n">administratorRole</span><span class="o">.</span><span class="na">getUsers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">());</span><span class="c1">// 赋予角色</span>
              <span class="n">administratorRole</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">});</span>
      <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
        <span class="c1">// 角色不存在，就新建角色</span>
        <span class="n">AVRole</span> <span class="n">administratorRole</span><span class="o">=</span><span class="k">new</span> <span class="n">AVRole</span><span class="o">(</span><span class="s">&quot;Administrator&quot;</span><span class="o">);</span>
        <span class="n">administratorRole</span><span class="o">.</span><span class="na">getUsers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">());</span><span class="c1">// 赋予角色</span>
        <span class="n">administratorRole</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_3" />
<label for="__tab_5_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 构建 AV.Role 的查询</span>
  <span class="kd">var</span> <span class="nx">administratorRole</span><span class="o">=</span> <span class="c1">//假设 administratorRole 是之前创建的 「Administrator」 角色;</span>
  <span class="kd">var</span> <span class="nx">roleQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">);</span>
  <span class="c1">// 角色名称等于 Administrator</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">);</span>
  <span class="c1">// 检查当前用户是否已经拥有了 Administrator 角色</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 当前用户已经具备了 Administrator 角色，因此不需要做任何操作</span>
      <span class="kd">var</span> <span class="nx">administratorRole</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">administratorRole</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 当前用户不具备 Administrator，因此你需要把当前用户添加到 Role 的 Users 中</span>
      <span class="kd">var</span> <span class="nx">relation</span> <span class="o">=</span> <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>
      <span class="nx">relation</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
      <span class="k">return</span> <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">administratorRole</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//此时 administratorRole 已经包含了当前用户</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 输出错误</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_5" type="radio" id="__tab_5_4" />
<label for="__tab_5_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>

<span class="n">role_query</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">)</span>
<span class="n">role_query</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">)</span>
<span class="n">role_query_list</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">role_query_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 该角色存在</span>
    <span class="n">administrator_role</span> <span class="o">=</span> <span class="n">role_query_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">role_query</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
    <span class="n">role_query_with_current_user</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">role_query_with_current_user</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c1"># 该角色存在，但是当前用户尚未被赋予该角色</span>
        <span class="n">relation</span> <span class="o">=</span> <span class="n">administrator_role</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
        <span class="n">relation</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>  <span class="c1"># 为当前用户赋予该角色</span>
        <span class="n">administrator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 该角色存在，当前用户已被被赋予该角色</span>
        <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># 该角色不存在，可以新建该角色，并把当前用户设置成该角色</span>
    <span class="n">administrator_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s1">&#39;Administrator&#39;</span><span class="p">)</span>
    <span class="n">relation</span> <span class="o">=</span> <span class="n">administrator_role</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
    <span class="n">relation</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
    <span class="n">administrator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
</div>
<p>角色赋予成功之后，基于角色的权限管理的功能才算完成。</p>
<ul>
<li>剥夺角色： 首先判断该用户是否已经被赋予该角色，如果未曾赋予则不做修改，如果已被赋予，则从对应的用户（AVUser）的 <code class="codehilite"><span class="n">roles</span></code> 属性当中把该角色删除。 </li>
</ul>
<div class="superfences-tabs">
<input name="__tabs_6" type="radio" id="__tab_6_0" checked="checked" />
<label for="__tab_6_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">roleQuery</span><span class="o">=</span> <span class="p">[</span><span class="n">AVRole</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;name&quot;</span> <span class="nl">equalTo</span><span class="p">:</span><span class="s">@&quot;Moderator&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 如果角色存在</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">objects</span> <span class="n">count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">AVRole</span> <span class="o">*</span><span class="n">moderatorRole</span><span class="o">=</span> <span class="p">[</span><span class="n">objects</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
            <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;users&quot;</span> <span class="nl">equalTo</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span>
            <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">){</span>
                <span class="c1">// 如果用户确实拥有该角色，那么就剥夺</span>
                <span class="k">if</span> <span class="p">([</span><span class="n">objects</span> <span class="n">count</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="p">[[</span><span class="n">moderatorRole</span> <span class="n">users</span> <span class="p">]</span>  <span class="nl">removeObject</span><span class="p">:[</span><span class="n">AVUser</span> <span class="n">currentUser</span><span class="p">]];</span>
                    <span class="p">[</span><span class="n">moderatorRole</span> <span class="n">saveInBackground</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}];</span>
        <span class="p">}</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_6" type="radio" id="__tab_6_1" />
<label for="__tab_6_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">roleQuery</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="s">&quot;Moderator&quot;</span><span class="p">)</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span>
            <span class="kd">let</span> <span class="nv">currentUser</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">(),</span>
            <span class="kd">let</span> <span class="nv">moderatorRole</span> <span class="p">=</span> <span class="n">objects</span><span class="p">?.</span><span class="bp">first</span> <span class="k">as</span><span class="p">?</span> <span class="n">AVRole</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="n">roleQuery</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;users&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="n">currentUser</span><span class="p">)</span>

        <span class="n">roleQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="kd">let</span> <span class="nv">_</span> <span class="p">=</span> <span class="n">objects</span><span class="p">?.</span><span class="bp">first</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span>
            <span class="p">}</span>
            <span class="n">moderatorRole</span><span class="p">.</span><span class="n">users</span><span class="p">().</span><span class="n">remove</span><span class="p">(</span><span class="n">currentUser</span><span class="p">)</span>
            <span class="n">moderatorRole</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_6" type="radio" id="__tab_6_2" />
<label for="__tab_6_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="kd">final</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">roleQuery</span><span class="o">=</span><span class="k">new</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;(</span><span class="s">&quot;_Role&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span><span class="s">&quot;Moderator&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
        <span class="kd">final</span> <span class="n">AVRole</span> <span class="n">moderatorRole</span><span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">roleQuery</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;users&quot;</span><span class="o">,</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">());</span>
        <span class="n">roleQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 如果该用户确实拥有该角色，那么就剥夺</span>
            <span class="k">if</span><span class="o">(</span><span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
              <span class="n">moderatorRole</span><span class="o">.</span><span class="na">getUsers</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">AVUser</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">());</span>
              <span class="n">moderatorRole</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
            <span class="o">}</span>
          <span class="o">}</span>
        <span class="o">});</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_6" type="radio" id="__tab_6_3" />
<label for="__tab_6_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 构建 AV.Role 的查询</span>
  <span class="kd">var</span> <span class="nx">roleQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">);</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Moderator&#39;</span><span class="p">);</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// 如果角色存在</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">moderatorRole</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
      <span class="k">return</span> <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">userForRole</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//该角色存在，并且也拥有该角色</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">userForRole</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// 剥夺角色</span>
      <span class="kd">var</span> <span class="nx">relation</span><span class="o">=</span> <span class="nx">moderatorRole</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>
      <span class="nx">relation</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
      <span class="k">return</span> <span class="nx">moderatorRole</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 保存成功</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 输出错误</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_6" type="radio" id="__tab_6_4" />
<label for="__tab_6_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>

<span class="n">role_query</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">)</span>
<span class="n">role_query</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">)</span>
<span class="n">role_query_list</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">role_query_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 该角色存在</span>
    <span class="n">administrator_role</span> <span class="o">=</span> <span class="n">role_query_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">role_query</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
    <span class="n">role_query_with_current_user</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">role_query_with_current_user</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c1"># 该角色存在，且当前用户拥有该角色</span>
        <span class="n">relation</span> <span class="o">=</span> <span class="n">administrator_role</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>
        <span class="n">relation</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
        <span class="c1"># 为当前用户剥夺该角色</span>
        <span class="n">administrator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 该角色存在，当前用户并不拥有该角色</span>
        <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># 该角色不存在，可以新建该角色，并把当前用户设置成该角色</span>
    <span class="k">pass</span>
</pre></div></div>
</div>
<h4 id="_11">角色的查询<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>除了在控制台可以直接查看已有角色之外，通过代码也可以直接查询当前应用中已存在的角色。
注：<code class="codehilite">AVRole</code> 也继承自 <code class="codehilite">AVObject</code>，因此熟悉了解 <code class="codehilite">AVQuery</code> 的开发者可以熟练的掌握关于角色查询的各种方法。</p>
<div class="superfences-tabs">
<input name="__tabs_7" type="radio" id="__tab_7_0" checked="checked" />
<label for="__tab_7_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 构建角色的查询，并且查看该角色所对应的用户</span>
    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">roleQuery</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVRole</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;name&quot;</span> <span class="nl">equalTo</span><span class="p">:</span><span class="s">@&quot;Administrator&quot;</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">AVRole</span> <span class="o">*</span><span class="n">administrator</span> <span class="o">=</span><span class="p">[</span><span class="n">objects</span> <span class="nl">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">AVRelation</span> <span class="o">*</span><span class="n">userRelation</span> <span class="o">=</span><span class="p">[</span><span class="n">administrator</span> <span class="n">users</span><span class="p">];</span>
        <span class="n">AVQuery</span> <span class="o">*</span><span class="n">userQuery</span> <span class="o">=</span> <span class="p">[</span><span class="n">userRelation</span> <span class="n">query</span><span class="p">];</span>
        <span class="p">[</span><span class="n">userQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// objects 就是拥有该角色权限的所有用户了。</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_1" />
<label for="__tab_7_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">roleQuery</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="s">&quot;Administrator&quot;</span><span class="p">)</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">roles</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="kd">let</span> <span class="nv">administrator</span> <span class="p">=</span> <span class="n">roles</span><span class="p">?.</span><span class="bp">first</span> <span class="k">as</span><span class="p">?</span> <span class="n">AVRole</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="kd">let</span> <span class="nv">userQuery</span> <span class="p">=</span> <span class="n">administrator</span><span class="p">.</span><span class="n">users</span><span class="p">().</span><span class="n">query</span><span class="p">()</span>

        <span class="n">userQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="c1">// users 就是拥有该角色权限的所有用户了。</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_2" />
<label for="__tab_7_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">roleQuery</span><span class="o">=</span><span class="k">new</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;(</span><span class="s">&quot;_Role&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">,</span> <span class="s">&quot;Administrator&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">AVRole</span> <span class="n">administrator</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
      <span class="n">AVRelation</span> <span class="n">userRelation</span><span class="o">=</span> <span class="n">administrator</span><span class="o">.</span><span class="na">getUsers</span><span class="o">();</span>
      <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">query</span><span class="o">=</span><span class="n">userRelation</span><span class="o">.</span><span class="na">getQuery</span><span class="o">();</span>
      <span class="n">query</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// list 就是拥有该角色权限的所有用户了。</span>
        <span class="o">}</span>
      <span class="o">});</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_3" />
<label for="__tab_7_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 新建针对 Role 的查询</span>
  <span class="kd">var</span> <span class="nx">roleQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">);</span>

  <span class="c1">// 查询 name 等于 Administrator 的角色</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">);</span>

  <span class="c1">// 执行查询</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">adminRole</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">userRelation</span> <span class="o">=</span> <span class="nx">adminRole</span><span class="p">.</span><span class="nx">relation</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">userRelation</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">find</span><span class="p">();</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">userList</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// userList 就是拥有该角色权限的所有用户了。</span>
    <span class="kd">var</span> <span class="nx">firstAdmin</span> <span class="o">=</span> <span class="nx">userList</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_7" type="radio" id="__tab_7_4" />
<label for="__tab_7_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">)</span>

<span class="n">role_query</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">)</span>
<span class="n">role_query</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Administrator&#39;</span><span class="p">)</span>
<span class="n">role_query_list</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">role_query_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># 该角色存在</span>
    <span class="n">administrator_role</span> <span class="o">=</span> <span class="n">role_query_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># 获取该角色对象</span>
    <span class="n">user_relation</span> <span class="o">=</span> <span class="n">administrator_role</span><span class="o">.</span><span class="n">relation</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">)</span>
    <span class="c1"># 查找该角色下的所有用户列表。如果这里有权限问题，请到控制台设置 leancloud.User 对象的权限</span>
    <span class="n">users_with_administrator</span> <span class="o">=</span> <span class="n">user_relation</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">users_with_administrator</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># 该角色不存在，可以新建该角色，并把当前用户设置成该角色</span>
    <span class="k">pass</span>
</pre></div></div>
</div>
<p>查询某一个用户拥有哪些角色：</p>
<div class="superfences-tabs">
<input name="__tabs_8" type="radio" id="__tab_8_0" checked="checked" />
<label for="__tab_8_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 第一种方式是通过内置的接口</span>
    <span class="p">[</span><span class="n">user</span> <span class="nl">getRolesInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span><span class="o">&lt;</span><span class="n">AVRole</span> <span class="o">*&gt;</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">avRoles</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span> <span class="n">_Nullable</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// avRoles 就是一个 AVRole 的数组，这些 AVRole 就是当前用户所在拥有的角色</span>
    <span class="p">}];</span>
    
    <span class="c1">// 第二种是通过构建 AVQuery</span>
    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">roleQuery</span><span class="o">=</span> <span class="p">[</span><span class="n">AVRole</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">whereKey</span><span class="p">:</span><span class="s">@&quot;users&quot;</span> <span class="nl">equalTo</span><span class="p">:</span> <span class="n">user</span><span class="p">];</span>
    <span class="p">[</span><span class="n">roleQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">avRoles</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// avRoles 就是一个 AVRole 的数组，这些 AVRole 就是当前用户所在拥有的角色</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_8" type="radio" id="__tab_8_1" />
<label for="__tab_8_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="k">guard</span> <span class="kd">let</span> <span class="nv">user</span> <span class="p">=</span> <span class="n">AVUser</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="n">user</span><span class="p">.</span><span class="n">getRolesInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">roles</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// avRoles 就是一个 AVRole 的数组，这些 AVRole 就是当前用户所在拥有的角色</span>
    <span class="p">}</span>

    <span class="c1">// 第二种是通过构建 AVQuery</span>
    <span class="kd">let</span> <span class="nv">roleQuery</span> <span class="p">=</span> <span class="n">AVRole</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">roleQuery</span><span class="p">.</span><span class="n">whereKey</span><span class="p">(</span><span class="s">&quot;users&quot;</span><span class="p">,</span> <span class="n">equalTo</span><span class="p">:</span> <span class="n">user</span><span class="p">)</span>
    <span class="n">roleQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">roles</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// avRoles 就是一个 AVRole 的数组，这些 AVRole 就是当前用户所在拥有的角色</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_8" type="radio" id="__tab_8_2" />
<label for="__tab_8_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 第一种方式是通过 AVUser 内置的接口：</span>
  <span class="n">user</span><span class="o">.</span><span class="na">getRolesInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">avRoles</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">avException</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// avRoles 表示这个用户拥有的角色</span>
    <span class="o">});</span>
    
  <span class="c1">// 第二种方式是通过构建 AVQuery：</span>
  <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">roleQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;(</span><span class="s">&quot;_Role&quot;</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">whereEqualTo</span><span class="o">(</span><span class="s">&quot;users&quot;</span><span class="o">,</span><span class="n">user</span><span class="o">);</span>
  <span class="n">roleQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVRole</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// list 就是一个 AVRole 的 List，这些 AVRole 就是当前用户所在拥有的角色</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_8" type="radio" id="__tab_8_3" />
<label for="__tab_8_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>   <span class="c1">//第一种是通过 AV.User 的内置接口：</span>
   <span class="nx">user</span><span class="p">.</span><span class="nx">getRoles</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">roles</span><span class="p">){</span>
    <span class="c1">// roles 是一个 AV.Role 数组，这些 AV.Role 表示 user 拥有的角色</span>
   <span class="p">});</span>
   
  <span class="c1">// 第二种是通过查询：</span>
  <span class="c1">// 新建角色查询</span>
  <span class="kd">var</span> <span class="nx">roleQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">);</span>
  <span class="c1">// 查询当前用户拥有的角色</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">equalTo</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">current</span><span class="p">());</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">roles</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// roles 是一个 AV.Role 数组，这些 AV.Role 表示当前用户所拥有的角色</span>
  <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_8" type="radio" id="__tab_8_4" />
<label for="__tab_8_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">user</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>

<span class="c1"># 第一种方式是通过 User 的内置接口：</span>
<span class="n">role_query_list</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">get_roles</span><span class="p">()</span>

<span class="c1"># 第二种方式是通过构建 Query：</span>
<span class="n">role_query</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">)</span>
<span class="n">role_query</span><span class="o">.</span><span class="n">equal_to</span><span class="p">(</span><span class="s1">&#39;users&#39;</span><span class="p">,</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">get_current</span><span class="p">())</span>
<span class="n">role_query_list</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>  <span class="c1"># 返回当前用户的角色列表</span>
</pre></div></div>
</div>
<p>查询哪些用户都被赋予 <code class="codehilite">Moderator</code> 角色：</p>
<div class="superfences-tabs">
<input name="__tabs_9" type="radio" id="__tab_9_0" checked="checked" />
<label for="__tab_9_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="n">AVRole</span> <span class="o">*</span><span class="n">moderatorRole</span> <span class="o">=</span><span class="c1">//根据 id 查询或者根据 name 查询出一个实例</span>
    <span class="n">AVRelation</span> <span class="o">*</span><span class="n">userRelation</span> <span class="o">=</span> <span class="p">[</span><span class="n">moderatorRole</span> <span class="n">users</span><span class="p">];</span>
    <span class="n">AVQuery</span> <span class="o">*</span><span class="n">userQuery</span> <span class="o">=</span> <span class="p">[</span><span class="n">userRelation</span> <span class="n">query</span><span class="p">];</span>
    <span class="p">[</span><span class="n">userQuery</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// objects 就是拥有 moderatorRole 角色的所有用户了。</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_9" type="radio" id="__tab_9_1" />
<label for="__tab_9_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">moderatorRole</span> <span class="p">=</span> <span class="o">&lt;</span><span class="p">#</span><span class="n">An</span> <span class="n">AVRole</span><span class="p">#</span><span class="o">&gt;</span>   <span class="c1">//根据 id 查询或者根据 name 查询出一个实例</span>
    <span class="kd">let</span> <span class="nv">userRelation</span> <span class="p">=</span> <span class="n">moderatorRole</span><span class="p">.</span><span class="n">users</span><span class="p">()</span>
    <span class="kd">let</span> <span class="nv">userQuery</span> <span class="p">=</span> <span class="n">userRelation</span><span class="p">.</span><span class="n">query</span><span class="p">()</span>

    <span class="n">userQuery</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="c1">// objects 就是拥有 moderatorRole 角色的所有用户了。</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_9" type="radio" id="__tab_9_2" />
<label for="__tab_9_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="n">AVRole</span> <span class="n">moderatorRole</span><span class="o">=</span> <span class="k">new</span> <span class="n">AVRole</span><span class="o">(</span><span class="s">&quot;Moderator&quot;</span><span class="o">);</span> <span class="c1">//根据 id 查询或者根据 name 查询出一个实例</span>
  <span class="n">AVRelation</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">userRelation</span><span class="o">=</span> <span class="n">moderatorRole</span><span class="o">.</span><span class="na">getUsers</span><span class="o">();</span>
  <span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">userQuery</span> <span class="o">=</span> <span class="n">userRelation</span><span class="o">.</span><span class="na">getQuery</span><span class="o">();</span>
  <span class="n">userQuery</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVUser</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// list 就是拥有该角色权限的所有用户了。</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_9" type="radio" id="__tab_9_3" />
<label for="__tab_9_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="kd">var</span> <span class="nx">roleQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">);</span>
  <span class="nx">roleQuery</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;55f1572460b2ce30e8b7afde&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">role</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//获取 Relation 实例</span>
    <span class="kd">var</span> <span class="nx">userRelation</span><span class="o">=</span> <span class="nx">role</span><span class="p">.</span><span class="nx">getUsers</span><span class="p">();</span>

    <span class="c1">// 获取查询实例</span>
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">userRelation</span><span class="p">.</span><span class="nx">query</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">query</span><span class="p">.</span><span class="nx">find</span><span class="p">();</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results 就是拥有 role 角色的所有用户了</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_9" type="radio" id="__tab_9_4" />
<label for="__tab_9_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">role_query</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">)</span>
<span class="n">role</span> <span class="o">=</span> <span class="n">role_query</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;573d5fdc2e958a0069f5d6fe&#39;</span><span class="p">)</span>  <span class="c1"># 根据 objectId 获取 role 对象</span>
<span class="n">user_relation</span> <span class="o">=</span> <span class="n">role</span><span class="o">.</span><span class="n">get_users</span><span class="p">()</span>  <span class="c1"># 获取 user 的 relation</span>

<span class="n">user_list</span> <span class="o">=</span> <span class="n">user_relation</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">find</span><span class="p">()</span>  <span class="c1"># 根据 relation 查找所包含的用户列表</span>
</pre></div></div>
</div>
<h4 id="_12">角色的从属关系<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>角色从属关系是为了实现不同角色的权限共享以及权限隔离。</p>
<p>权限共享很好理解，比如管理员拥有论坛所有板块的管理权限，而版主只拥有单一板块的管理权限，如果开发一个版主使用的新功能，都要同样的为管理员设置该项功能权限，代码就会冗余，因此，我们通俗的理解是：管理员也是版主，只是他是所有板块的版主。因此，管理员在角色从属的关系上是属于版主的，只不过 TA 是特殊的版主。</p>
<div class="superfences-tabs">
<input name="__tabs_10" type="radio" id="__tab_10_0" checked="checked" />
<label for="__tab_10_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="n">AVRole</span> <span class="o">*</span><span class="n">administratorRole</span> <span class="o">=</span> <span class="c1">//从服务端查询出 Administrator 角色实例</span>
    <span class="n">AVRole</span> <span class="o">*</span><span class="n">moderatorRole</span> <span class="o">=</span> <span class="c1">//从服务端查询出 Moderator 角色实例</span>
    
    <span class="c1">// 向 moderatorRole 的 roles（AVRelation）中添加 administratorRole</span>
    <span class="p">[[</span><span class="n">moderatorRole</span> <span class="n">roles</span><span class="p">]</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">administratorRole</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">moderatorRole</span> <span class="n">saveInBackground</span><span class="p">];</span>
    <span class="cm">/**</span>
<span class="cm">     * 以上用同步方法是为了保证在调用 [[moderator roles] addObject:administratorRole] 之前 administratorRole 和 moderator 都已保存在服务端</span>
<span class="cm">     **/</span>
</pre></div></div>
<input name="__tabs_10" type="radio" id="__tab_10_1" />
<label for="__tab_10_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">administratorRole</span><span class="p">:</span> <span class="n">AVRole</span> <span class="p">=</span> <span class="o">&lt;</span><span class="p">#</span><span class="n">An</span> <span class="n">AVRole</span><span class="p">#</span><span class="o">&gt;</span>    <span class="c1">// 从服务端查询出 Administrator 角色实例</span>
    <span class="kd">let</span> <span class="nv">moderatorRole</span><span class="p">:</span> <span class="n">AVRole</span> <span class="p">=</span> <span class="o">&lt;</span><span class="p">#</span><span class="n">An</span> <span class="n">AVRole</span><span class="p">#</span><span class="o">&gt;</span>    <span class="c1">//从服务端查询出 Moderator 角色实例</span>

    <span class="n">moderatorRole</span><span class="p">.</span><span class="n">roles</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">administratorRole</span><span class="p">)</span>
    <span class="n">moderatorRole</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
<input name="__tabs_10" type="radio" id="__tab_10_2" />
<label for="__tab_10_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="n">AVRole</span> <span class="n">administratorRole</span> <span class="o">=</span> <span class="c1">// 从服务端查询 Administrator 实例</span>
  <span class="n">AVRole</span> <span class="n">moderatorRole</span> <span class="o">=</span> <span class="c1">// 从服务端查询 Moderator 实例</span>

  <span class="c1">// 向 moderatorRole 的 roles（AVRelation） 中添加 administratorRole</span>
  <span class="n">moderatorRole</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">administratorRole</span><span class="o">);</span>
  <span class="n">moderatorRole</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
</pre></div></div>
<input name="__tabs_10" type="radio" id="__tab_10_3" />
<label for="__tab_10_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">// 建立版主和论坛管理员之间的从属关系</span>
  <span class="kd">var</span> <span class="nx">administratorRole</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Administrator&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">administratorRole</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">administratorRole</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//新建版主角色</span>
    <span class="kd">var</span> <span class="nx">moderatorRole</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Moderator&#39;</span><span class="p">);</span>

    <span class="c1">// 将 Administrator 作为 moderatorRole 子角色</span>
    <span class="nx">moderatorRole</span><span class="p">.</span><span class="nx">getRoles</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">administratorRole</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">moderatorRole</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">role</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">chai</span><span class="p">.</span><span class="nx">assert</span><span class="p">.</span><span class="nx">isNotNull</span><span class="p">(</span><span class="nx">role</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">done</span><span class="p">();</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
  <span class="p">});</span>
</pre></div></div>
<input name="__tabs_10" type="radio" id="__tab_10_4" />
<label for="__tab_10_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="c1"># 建立版主和论坛管理员之间的角色从属关系</span>
<span class="n">administrator_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s2">&quot;Administrator&quot;</span><span class="p">)</span>  <span class="c1"># 新建角色</span>
<span class="n">moderator_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s2">&quot;Moderator&quot;</span><span class="p">)</span>  <span class="c1"># 新建角色</span>

<span class="n">moderator_acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">()</span>
<span class="c1"># 这里为了在后面可以添加 moderator_role 可以添加 role， 设置一个可写权限</span>
<span class="n">moderator_acl</span><span class="o">.</span><span class="n">set_public_write_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">moderator_role</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">moderator_acl</span><span class="p">)</span>

<span class="n">administrator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">moderator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># 将 Administrator 设为 moderator_role 一个子角色</span>
<span class="n">moderator_role</span><span class="o">.</span><span class="n">get_roles</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">administrator_role</span><span class="p">)</span>
<span class="n">moderator_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
</div>
<p>权限隔离也就是两个角色不存在从属关系，但是某些权限又是共享的，此时不妨设计一个中间角色，让前面两个角色从属于中间角色，这样在逻辑上可以很快梳理，其实本质上还是使用了角色的从属关系。</p>
<p>比如，版主 A 是摄影器材板块的版主，而版主 B 是手机平板板块的版主，现在新开放了一个电子数码版块，而需求规定 A 和 B 都同时具备管理电子数码板块的权限，但是 A 不具备管理手机平板版块的权限，反之亦然，那么就需要设置一个电子数码板块的版主角色（中间角色），同时让 A 和 B 拥有该角色即可。</p>
<div class="superfences-tabs">
<input name="__tabs_11" type="radio" id="__tab_11_0" checked="checked" />
<label for="__tab_11_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 新建 3 个角色实例</span>
    <span class="n">AVRole</span> <span class="o">*</span><span class="n">photographicRole</span> <span class="o">=</span> <span class="c1">//创建或者从服务端查询出 Photographic 角色实例</span>
    <span class="n">AVRole</span> <span class="o">*</span><span class="n">mobileRole</span> <span class="o">=</span> <span class="c1">//创建或从服务端查询出 Mobile 角色实例</span>
    <span class="n">AVRole</span> <span class="o">*</span><span class="n">digitalRole</span> <span class="o">=</span> <span class="c1">//创建或从服务端查询出 Digital 角色实例</span>
    
    <span class="c1">// photographicRole 和 mobileRole 继承了 digitalRole</span>
    <span class="p">[[</span><span class="n">digitalRole</span> <span class="n">roles</span><span class="p">]</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">photographicRole</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">digitalRole</span> <span class="n">roles</span><span class="p">]</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">mobileRole</span><span class="p">];</span>

    <span class="p">[</span><span class="n">digitalRole</span> <span class="nl">saveInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">succeeded</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
       
        <span class="n">AVObject</span> <span class="o">*</span><span class="n">photographicPost</span><span class="o">=</span> <span class="p">[</span><span class="n">AVObject</span> <span class="nl">objectWithClassName</span><span class="p">:</span><span class="s">@&quot;Post&quot;</span><span class="p">];</span>
        <span class="n">AVObject</span> <span class="o">*</span><span class="n">mobilePost</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVObject</span> <span class="nl">objectWithClassName</span><span class="p">:</span><span class="s">@&quot;Post&quot;</span><span class="p">];</span>
        <span class="n">AVObject</span> <span class="o">*</span><span class="n">digitalPost</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVObject</span> <span class="nl">objectWithClassName</span><span class="p">:</span><span class="s">@&quot;Post&quot;</span><span class="p">];</span>
        <span class="c1">//.....此处省略一些具体的值设定</span>
        
        <span class="n">AVACL</span> <span class="o">*</span><span class="n">photographicACL</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
        <span class="p">[</span><span class="n">photographicACL</span> <span class="nl">setReadAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forRole</span><span class="p">:</span><span class="n">photographicRole</span><span class="p">];</span>
        <span class="p">[</span><span class="n">photographicACL</span> <span class="nl">setPublicReadAccess</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
        <span class="p">[</span><span class="n">photographicACL</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forRole</span><span class="p">:</span><span class="n">photographicRole</span><span class="p">];</span>
        <span class="p">[</span><span class="n">photographicPost</span> <span class="nl">setACL</span><span class="p">:</span><span class="n">photographicACL</span><span class="p">];</span>
        
        <span class="n">AVACL</span> <span class="o">*</span><span class="n">mobileACL</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
        <span class="p">[</span><span class="n">mobileACL</span> <span class="nl">setReadAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forRole</span><span class="p">:</span><span class="n">mobileRole</span><span class="p">];</span>
        <span class="p">[</span><span class="n">mobileACL</span> <span class="nl">setWriteAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forRole</span><span class="p">:</span><span class="n">mobileRole</span><span class="p">];</span>
        <span class="p">[</span><span class="n">mobilePost</span> <span class="nl">setACL</span><span class="p">:</span><span class="n">mobileACL</span><span class="p">];</span>
        
        <span class="n">AVACL</span> <span class="o">*</span><span class="n">digitalACL</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVACL</span> <span class="n">ACL</span><span class="p">];</span>
        <span class="p">[</span><span class="n">digitalACL</span> <span class="nl">setReadAccess</span><span class="p">:</span><span class="nb">YES</span> <span class="nl">forRole</span><span class="p">:</span><span class="n">digitalRole</span><span class="p">];</span>
        <span class="p">[</span><span class="n">digitalPost</span> <span class="nl">setACL</span><span class="p">:</span><span class="n">digitalACL</span><span class="p">];</span>
        
        <span class="c1">// photographicPost 只有 photographicRole 可以读写</span>
        <span class="c1">// mobilePost 只有 mobileRole 可以读写</span>
        <span class="c1">// 而 photographicRole，mobileRole，digitalRole 均可以对 digitalPost 进行读写</span>
        <span class="p">[</span><span class="n">photographicPost</span> <span class="n">saveInBackground</span><span class="p">];</span>
        <span class="p">[</span><span class="n">mobilePost</span> <span class="n">saveInBackground</span><span class="p">];</span>
        <span class="p">[</span><span class="n">digitalPost</span> <span class="n">saveInBackground</span><span class="p">];</span>
    <span class="p">}];</span>
</pre></div></div>
<input name="__tabs_11" type="radio" id="__tab_11_1" />
<label for="__tab_11_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">photographicRole</span><span class="p">:</span> <span class="n">AVRole</span> <span class="p">=</span> <span class="o">&lt;</span><span class="p">#</span><span class="n">An</span> <span class="n">Role</span><span class="p">#</span><span class="o">&gt;</span>
    <span class="kd">let</span> <span class="nv">mobileRole</span><span class="p">:</span> <span class="n">AVRole</span> <span class="p">=</span> <span class="o">&lt;</span><span class="p">#</span><span class="n">An</span> <span class="n">Role</span><span class="p">#</span><span class="o">&gt;</span>
    <span class="kd">let</span> <span class="nv">digitalRole</span><span class="p">:</span> <span class="n">AVRole</span> <span class="p">=</span> <span class="o">&lt;</span><span class="p">#</span><span class="n">An</span> <span class="n">Role</span><span class="p">#</span><span class="o">&gt;</span>

    <span class="n">digitalRole</span><span class="p">.</span><span class="n">roles</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">photographicRole</span><span class="p">)</span>
    <span class="n">digitalRole</span><span class="p">.</span><span class="n">roles</span><span class="p">().</span><span class="n">add</span><span class="p">(</span><span class="n">mobileRole</span><span class="p">)</span>

    <span class="n">digitalRole</span><span class="p">.</span><span class="n">saveInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">succeeded</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="n">succeeded</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="kd">let</span> <span class="nv">photographicPost</span> <span class="p">=</span> <span class="n">AVObject</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">photographicACL</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

        <span class="n">photographicACL</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="n">photographicACL</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">photographicRole</span><span class="p">)</span>
        <span class="n">photographicPost</span><span class="p">.</span><span class="n">acl</span> <span class="p">=</span> <span class="n">photographicACL</span>

        <span class="kd">let</span> <span class="nv">mobilePost</span> <span class="p">=</span> <span class="n">AVObject</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">mobileACL</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

        <span class="n">mobileACL</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="n">mobileACL</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">mobileRole</span><span class="p">)</span>
        <span class="n">mobilePost</span><span class="p">.</span><span class="n">acl</span> <span class="p">=</span> <span class="n">mobileACL</span>

        <span class="kd">let</span> <span class="nv">digitalPost</span> <span class="p">=</span> <span class="n">AVObject</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Post&quot;</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">digitalACL</span> <span class="p">=</span> <span class="n">AVACL</span><span class="p">()</span>

        <span class="n">digitalACL</span><span class="p">.</span><span class="n">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
        <span class="n">digitalACL</span><span class="p">.</span><span class="n">setWriteAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">digitalRole</span><span class="p">)</span>
        <span class="n">digitalPost</span><span class="p">.</span><span class="n">acl</span> <span class="p">=</span> <span class="n">digitalACL</span>

        <span class="n">AVObject</span><span class="p">.</span><span class="n">saveAll</span><span class="p">([</span>
            <span class="n">photographicPost</span><span class="p">,</span>
            <span class="n">mobilePost</span><span class="p">,</span>
            <span class="n">digitalPost</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_11" type="radio" id="__tab_11_2" />
<label for="__tab_11_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="c1">// 新建 3个角色实例</span>
  <span class="n">AVRole</span> <span class="n">photographicRole</span> <span class="o">=</span> <span class="c1">// 创建或者创建 Photographic 角色</span>
  <span class="n">AVRole</span> <span class="n">mobileRole</span> <span class="o">=</span> <span class="c1">// 创建或者创建 Mobile 角色</span>
  <span class="n">AVRole</span> <span class="n">digitalRole</span> <span class="o">=</span> <span class="c1">// 创建或者创建 Digital 角色</span>

  <span class="c1">// photographicRole 和 mobileRole 继承了 digitalRole</span>
  <span class="n">digitalRole</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">photographicRole</span><span class="o">);</span>
  <span class="n">digitalRole</span><span class="o">.</span><span class="na">getRoles</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">mobileRole</span><span class="o">);</span>

  <span class="n">digitalRole</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">SaveCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

      <span class="c1">//新建 3 篇贴子，分别发在不同的板块上</span>
      <span class="n">AVObject</span> <span class="n">photographicPost</span><span class="o">=</span> <span class="k">new</span> <span class="n">AVObject</span> <span class="o">(</span><span class="s">&quot;Post&quot;</span><span class="o">);</span>
      <span class="n">AVObject</span> <span class="n">mobilePost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVObject</span><span class="o">(</span><span class="s">&quot;Post&quot;</span><span class="o">);</span>
      <span class="n">AVObject</span> <span class="n">digitalPost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVObject</span><span class="o">(</span><span class="s">&quot;Post&quot;</span><span class="o">);</span>
      <span class="c1">//.....此处省略一些具体的值设定</span>

      <span class="n">AVACL</span> <span class="n">photographicACL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
      <span class="n">photographicACL</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">photographicACL</span><span class="o">.</span><span class="na">setRoleWriteAccess</span><span class="o">(</span><span class="n">photographicRole</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
      <span class="n">photographicPost</span><span class="o">.</span><span class="na">setACL</span><span class="o">(</span><span class="n">photographicACL</span><span class="o">);</span>

      <span class="n">AVACL</span> <span class="n">mobileACL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
      <span class="n">mobileACL</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">mobileACL</span><span class="o">.</span><span class="na">setRoleWriteAccess</span><span class="o">(</span><span class="n">mobileRole</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
      <span class="n">mobilePost</span><span class="o">.</span><span class="na">setACL</span><span class="o">(</span><span class="n">mobileACL</span><span class="o">);</span>

      <span class="n">AVACL</span> <span class="n">digitalACL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVACL</span><span class="o">();</span>
      <span class="n">digitalACL</span><span class="o">.</span><span class="na">setPublicReadAccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
      <span class="n">digitalACL</span><span class="o">.</span><span class="na">setRoleWriteAccess</span><span class="o">(</span><span class="n">digitalRole</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
      <span class="n">digitalPost</span><span class="o">.</span><span class="na">setACL</span><span class="o">(</span><span class="n">digitalACL</span><span class="o">);</span>

      <span class="c1">// photographicPost 只有 photographicRole 可以读写</span>
      <span class="c1">// mobilePost 只有 mobileRole 可以读写</span>
      <span class="c1">// 而 photographicRole，mobileRole，digitalRole 均可以对 digitalPost 进行读写</span>
      <span class="n">photographicPost</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
      <span class="n">mobilePost</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
      <span class="n">digitalPost</span><span class="o">.</span><span class="na">saveInBackground</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">});</span>
</pre></div></div>
<input name="__tabs_11" type="radio" id="__tab_11_3" />
<label for="__tab_11_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>  <span class="c1">//新建摄影器材版主角色</span>
  <span class="kd">var</span> <span class="nx">photographicRole</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Photographic&#39;</span><span class="p">);</span>

  <span class="c1">//新建手机平板版主角色</span>
  <span class="kd">var</span> <span class="nx">mobileRole</span><span class="o">=</span><span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Mobile&#39;</span><span class="p">);</span>

  <span class="c1">//新建电子数码版主角色</span>
  <span class="kd">var</span> <span class="nx">digitalRole</span><span class="o">=</span><span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Role</span><span class="p">(</span><span class="s1">&#39;Digital&#39;</span><span class="p">);</span>

   <span class="nx">AV</span><span class="p">.</span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
    <span class="c1">// 先行保存 photographicRole 和 mobileRole</span>
    <span class="nx">photographicRole</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span>
    <span class="nx">mobileRole</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span>
  <span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">([</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// 将 photographicRole 和 mobileRole 设为 digitalRole 一个子角色</span>
    <span class="nx">digitalRole</span><span class="p">.</span><span class="nx">getRoles</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">photographicRole</span><span class="p">);</span>
    <span class="nx">digitalRole</span><span class="p">.</span><span class="nx">getRoles</span><span class="p">().</span><span class="nx">add</span><span class="p">(</span><span class="nx">mobileRole</span><span class="p">);</span>
    <span class="nx">digitalRole</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

    <span class="c1">// 新建一个帖子对象</span>
    <span class="kd">var</span> <span class="nx">Post</span> <span class="o">=</span> <span class="nx">AV</span><span class="p">.</span><span class="nb">Object</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="s1">&#39;Post&#39;</span><span class="p">);</span>

    <span class="c1">// 新建摄影器材板块的帖子</span>
    <span class="kd">var</span> <span class="nx">photographicPost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">();</span>
    <span class="nx">photographicPost</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;我是摄影器材板块的帖子！&#39;</span><span class="p">);</span>

    <span class="c1">// 新建手机平板板块的帖子</span>
    <span class="kd">var</span> <span class="nx">mobilePost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">();</span>
    <span class="nx">mobilePost</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;我是手机平板板块的帖子！&#39;</span><span class="p">);</span>

    <span class="c1">// 新建电子数码板块的帖子</span>
    <span class="kd">var</span> <span class="nx">digitalPost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Post</span><span class="p">();</span>
    <span class="nx">digitalPost</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;我是电子数码板块的帖子！&#39;</span><span class="p">);</span>


    <span class="c1">// 新建一个摄影器材版主可写的 ACL 实例</span>
    <span class="kd">var</span> <span class="nx">photographicACL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
    <span class="nx">photographicACL</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">photographicACL</span><span class="p">.</span><span class="nx">setRoleWriteAccess</span><span class="p">(</span><span class="nx">photographicRole</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

    <span class="c1">// 新建一个手机平板版主可写的 ACL 实例</span>
    <span class="kd">var</span> <span class="nx">mobileACL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
    <span class="nx">mobileACL</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">mobileACL</span><span class="p">.</span><span class="nx">setRoleWriteAccess</span><span class="p">(</span><span class="nx">mobileRole</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

    <span class="c1">// 新建一个手机平板版主可写的 ACL 实例</span>
    <span class="kd">var</span> <span class="nx">digitalACL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">ACL</span><span class="p">();</span>
    <span class="nx">digitalACL</span><span class="p">.</span><span class="nx">setPublicReadAccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">digitalACL</span><span class="p">.</span><span class="nx">setRoleWriteAccess</span><span class="p">(</span><span class="nx">digitalRole</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

    <span class="c1">// photographicPost 只有 photographicRole 可以读写</span>
    <span class="c1">// mobilePost 只有 mobileRole 可以读写</span>
    <span class="c1">// 而 photographicRole，mobileRole，digitalRole 均可以对 digitalPost 进行读写</span>
    <span class="nx">photographicPost</span><span class="p">.</span><span class="nx">setACL</span><span class="p">(</span><span class="nx">photographicACL</span><span class="p">);</span>
    <span class="nx">mobilePost</span><span class="p">.</span><span class="nx">setACL</span><span class="p">(</span><span class="nx">mobileACL</span><span class="p">);</span>
    <span class="nx">digitalPost</span><span class="p">.</span><span class="nx">setACL</span><span class="p">(</span><span class="nx">digitalACL</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">AV</span><span class="p">.</span><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span>
      <span class="nx">photographicPost</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span>
      <span class="nx">mobilePost</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span>
      <span class="nx">digitalPost</span><span class="p">.</span><span class="nx">save</span><span class="p">(),</span>
    <span class="p">]);</span>
   <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">([</span><span class="nx">r1</span><span class="p">,</span> <span class="nx">r2</span><span class="p">,</span> <span class="nx">r3</span><span class="p">])</span> <span class="p">{</span>
     <span class="c1">// 保存成功</span>
     <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">errors</span><span class="p">)</span> <span class="p">{</span>
     <span class="c1">// 保存失败</span>
   <span class="p">});;</span>
</pre></div></div>
<input name="__tabs_11" type="radio" id="__tab_11_4" />
<label for="__tab_11_4">Python</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">leancloud</span>

<span class="n">photographic_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s2">&quot;Photographic&quot;</span><span class="p">)</span> <span class="c1"># 新建摄影器材版主角色</span>
<span class="n">mobile_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s2">&quot;Mobile&quot;</span><span class="p">)</span>  <span class="c1"># 新建手机平板版主角色</span>
<span class="n">digital_role</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Role</span><span class="p">(</span><span class="s2">&quot;Digital&quot;</span><span class="p">)</span>  <span class="c1"># 新建电子数码版主角色</span>

<span class="c1"># 先行保存 photographic_role 和 mobile_role</span>
<span class="n">photographic_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">mobile_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1"># 将 photographic_role 和 mobile_role 设为 digital_role 一个子角色</span>
<span class="n">digital_role</span><span class="o">.</span><span class="n">get_roles</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">photographic_role</span><span class="p">)</span>
<span class="n">digital_role</span><span class="o">.</span><span class="n">get_roles</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">mobile_role</span><span class="p">)</span>
<span class="n">digital_role</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c1"># 保存</span>


<span class="c1"># 新建一个帖子对象</span>
<span class="n">Post</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="s2">&quot;Post&quot;</span><span class="p">)</span>

<span class="c1"># 新建摄影器材板块的帖子</span>
<span class="n">photographic_post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="n">photographic_post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;我是摄影器材板块的帖子！&quot;</span><span class="p">)</span>

<span class="c1"># 新建手机平板板块的帖子</span>
<span class="n">mobile_post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="n">mobile_post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;我是手机平板板块的帖子！&quot;</span><span class="p">)</span>

<span class="c1"># 新建电子数码板块的帖子</span>
<span class="n">digital_post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">()</span>
<span class="n">digital_post</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;我是电子数码板块的帖子！&quot;</span><span class="p">)</span>


<span class="c1"># 新建一个摄影器材版主可写的 leancloud.ACL 实例</span>
<span class="n">photographic_acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">()</span>
<span class="n">photographic_acl</span><span class="o">.</span><span class="n">set_public_read_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">photographic_acl</span><span class="o">.</span><span class="n">set_role_write_access</span><span class="p">(</span><span class="n">photographic_role</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># 新建一个手机平板版主可写的 leancloud.ACL 实例</span>
<span class="n">mobile_acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">();</span>
<span class="n">mobile_acl</span><span class="o">.</span><span class="n">set_public_read_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">mobile_acl</span><span class="o">.</span><span class="n">set_role_write_access</span><span class="p">(</span><span class="n">mobile_role</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># 新建一个手机平板版主可写的 leancloud.ACL 实例</span>
<span class="n">digital_acl</span> <span class="o">=</span> <span class="n">leancloud</span><span class="o">.</span><span class="n">ACL</span><span class="p">()</span>
<span class="n">digital_acl</span><span class="o">.</span><span class="n">set_public_read_access</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">digital_acl</span><span class="o">.</span><span class="n">set_role_write_access</span><span class="p">(</span><span class="n">digital_role</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># photographic_post 只有 photographic_role 可以读写</span>
<span class="c1"># mobile_post 只有 mobile_role 可以读写</span>
<span class="c1"># 而 photographic_role，mobile_role，digital_role 均可以对 digital_post 进行读写</span>
<span class="n">photographic_post</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">photographic_acl</span><span class="p">)</span>
<span class="n">mobile_post</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">mobile_acl</span><span class="p">)</span>
<span class="n">digital_post</span><span class="o">.</span><span class="n">set_acl</span><span class="p">(</span><span class="n">digital_acl</span><span class="p">)</span>

<span class="n">photographic_post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">mobile_post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="n">digital_post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div></div>
</div>
<h3 id="_13">权限的分级<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>在日常生活中，我们也遇到过权限分级的问题，例如新的系统又一次升级，引入了超级管理员的概念，这个超级管理员可以对系统里面任何的对象进行「读写操作」，按照前文的做法，需要用代码实现如下步骤：</p>
<ol>
<li>创建超级管理员角色</li>
<li>遍历云端现有的帖子，为所有对象添加超级管理员的「ACL 读写权限」</li>
<li>保存数据</li>
</ol>
<p>开发者一旦面对这种逻辑重复的代码，一般都会想到：有没有一个快捷的操作可以一次性为某一个角色添加整个 Class 添加权限？</p>
<p>当然，LeanCloud 也已经提供了便捷的可视化的操作。打开 <strong>控制台</strong> &gt; <strong>存储</strong> &gt; <strong>Post</strong> &gt; <strong>其他</strong> &gt; <strong>权限设置</strong>，如下图所示：</p>
<p><img alt="acl_in_console" src="images/console-acl-superadmin.png" /></p>
<p>在这里你可以设置某一个角色对 <code class="codehilite">Post</code> 的操作权限：选择 <strong>指定用户</strong>，在指定角色中输入 <code class="codehilite">superAdmin</code>，并且点击添加即可。</p>
<p>如此设置，无需书写代码，在项目迭代过程中有角色加入都可以用这种便捷的方式进行操作。</p>
<p>权限设置的参数以及操作解释如下：</p>
<table>
<thead>
<tr>
<th>参数名</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>add_fields</td>
<td>添加新字段到 Class</td>
</tr>
<tr>
<td>create</td>
<td>保存一个从未创建过的新对象</td>
</tr>
<tr>
<td>delete</td>
<td>删除一个对象</td>
</tr>
<tr>
<td>find</td>
<td>发起一次对象列表查询</td>
</tr>
<tr>
<td>get</td>
<td>通过 objectId 获取对象</td>
</tr>
<tr>
<td>update</td>
<td>保存一个已经存在并且被修改的对象</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>权限对象名</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>所有用户</td>
<td>任意用户均有权限</td>
</tr>
<tr>
<td>登录用户</td>
<td>用户登录之后，具有权限</td>
</tr>
<tr>
<td>指定用户</td>
<td>可以指定具体的用户（<code class="codehilite">_User</code>）也可以指定具体的角色（<code class="codehilite">_Role</code>）</td>
</tr>
</tbody>
</table>
<h4 id="class-object-acl">表 Class 和对象 Object 的 ACL 组合<a class="headerlink" href="#class-object-acl" title="Permanent link">&para;</a></h4>
<p>假设现在需要新增一张表，我们推荐有关系型数据库开发经验的开发者采用如下步骤：</p>
<ol>
<li>进入 <strong>控制台</strong> &gt; <strong>存储</strong> &gt; <strong>创建 Class</strong>，会弹出如下界面：</li>
</ol>
<p><img src="images/console-create-class-acl.png" width="600"></p>
<ol>
<li>
<p>然后根据实际业务逻辑的需求选择这张表的权限，例如这张表默认是限制写入。</p>
</li>
<li>
<p>而在后期开发的过程中发现，有一两个对象需要共享给其他用户也可修改，比如一篇博客想发布在公网上，审核人员是需要写权限的，因此可以通过代码在创建对象的时候指定一个 ACL 就可以实现这种动态的 ACL 效果（代码示例 <a href="#单用户权限设置">单用户权限设置</a>）。</p>
</li>
</ol>
<p>总之，LeanCloud 的 ACL 的鉴权逻辑是先验证 Class 级别的 ACL 是否允许通过，紧接着就会针对访问的对象自身的 ACL 进行鉴权。
换言之，偏向于静态设置的应用可以通过创建 Class 时候的选择来实现，而有动态需求的应用尽量在创建对象的时候设置 ACL。</p>
<h2 id="acl_3">获取对象的 ACL 值<a class="headerlink" href="#acl_3" title="Permanent link">&para;</a></h2>
<p>查询数据时，SDK 默认不会返回对象的 ACL 值。如果想在获取对象的同时返回对象的 ACL 值，需要同时满足下面两个条件：</p>
<ol>
<li>进入 <a href="/dashboard/storage.html?appid={{appid}}#/storage/conf">控制台 &gt; 存储 &gt; 设置 &gt; 其他</a>，勾选「查询时返回值包括 ACL」才可以在查询结果中获取到 ACL 的数据。</li>
<li>客户端查询对象时需要指定 <code class="codehilite">includeACL</code>。</li>
</ol>
<p>代码如下：</p>
<div class="superfences-tabs">
<input name="__tabs_12" type="radio" id="__tab_12_0" checked="checked" />
<label for="__tab_12_0">Objective-C</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="n">AVQuery</span> <span class="o">*</span><span class="n">query</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVQuery</span> <span class="nl">queryWithClassName</span><span class="p">:</span><span class="s">@&quot;Todo&quot;</span><span class="p">];</span>
<span class="n">query</span><span class="p">.</span><span class="n">includeACL</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">[</span><span class="n">query</span> <span class="nl">findObjectsInBackgroundWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="bp">NSArray</span> <span class="o">*</span><span class="n">objects</span><span class="p">,</span> <span class="bp">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        
<span class="p">}];</span>
</pre></div></div>
<input name="__tabs_12" type="radio" id="__tab_12_1" />
<label for="__tab_12_1">Swift</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span>    <span class="kd">let</span> <span class="nv">query</span> <span class="p">=</span> <span class="n">AVQuery</span><span class="p">(</span><span class="n">className</span><span class="p">:</span> <span class="s">&quot;Todo&quot;</span><span class="p">)</span>

    <span class="n">query</span><span class="p">.</span><span class="n">includeACL</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="n">query</span><span class="p">.</span><span class="n">findObjectsInBackground</span> <span class="p">{</span> <span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="p">}</span>
</pre></div></div>
<input name="__tabs_12" type="radio" id="__tab_12_2" />
<label for="__tab_12_2">Java</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="n">AVQuery</span><span class="o">&lt;</span><span class="n">AVObject</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AVQuery</span><span class="o">&lt;&gt;(</span><span class="s">&quot;Todo&quot;</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">includeACL</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">findInBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">FindCallback</span><span class="o">&lt;</span><span class="n">AVObject</span><span class="o">&gt;()</span> <span class="o">{</span>
     <span class="nd">@Override</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">done</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AVObject</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">,</span> <span class="n">AVException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                
     <span class="o">}</span>
<span class="o">});</span>
</pre></div></div>
<input name="__tabs_12" type="radio" id="__tab_12_3" />
<label for="__tab_12_3">JavaScript</label>
<div class="superfences-content"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AV</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="s1">&#39;Todo&#39;</span><span class="p">);</span>
<span class="nx">query</span><span class="p">.</span><span class="nx">includeACL</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="nx">query</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">todos</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 查询结果</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">){</span>
  <span class="c1">// 异常处理</span>
<span class="p">})</span>
</pre></div></div>
</div>
<h2 id="_14">超级权限<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>ACL 可以满足常见的需求，但是 <code class="codehilite">_User</code> 表比较特殊，它会忽略 ACL 的设置，表现为：任何用户都无法修改其他用户的属性，比如当前登录的用户是 A，而他想通过请求去修改 B 用户的用户名，密码或者其他自定义属性，是不会生效的。</p>
<p>但是有时一些应用的需求较为特殊，比如，论坛的管理员可以修改某些用户的昵称，性别（假设昵称和性别是存储在 <code class="codehilite">_User</code> 的 <code class="codehilite">gender</code>、<code class="codehilite">age</code> 字段上），此时通过设置管理员拥有该用户的 ACL 写的权限是无法实现预想效果的。</p>
<p>因此，我们提供了一种方式去提高操作的权限，在支持云引擎的 SDK 中的实现方式是在初始化的时候，增加一个 Master Key 的字段作为提高权限的接口。Master Key 可以在 <strong>控制台</strong> &gt; <strong>设置</strong> &gt; <strong>应用 Key</strong> 中获取。</p>
<p>{{ docs.alert("Objective-C 以及 Android SDK 不可以使用 Master Key。") }}</p>
<h2 id="_15">最佳实践<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h2>
<p>本章节的目的是介绍如何在 <a href="acl_guide_leanengine.html">云引擎</a> 里面使用 ACL 。</p>
<p>我们先来探索一个需求：某个应用它拥有众多客户端，iOS、Andorid、Windows 等，还有 Web 版，未来可能还会有手环，手表客户端，那么关于 ACL 的代码会遍布在所有客户端，那么开发者就会需要不断的升级和维护逻辑十分类似的客户端代码，到了这一步，我们更推荐，开发者在服务端定义一段 ACL 的逻辑，统一处理 ACL 权限分配的问题。</p>
<p>【总结】假如应用的平台比较固定，那么就可以考虑采取本文前面所介绍的客户端代码实现 ACL 代码。如果应用的平台比较多，多平台多客户端就推荐使用 <a href="acl_guide_leanengine.html">云引擎 Hook 函数使用 ACL</a>。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../storage-overview/" title="服务总览" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                服务总览
              </span>
            </div>
          </a>
        
        
          <a href="../../engine/engine-overview/" title="服务总览" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                服务总览
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2014 - 2018 LeanCloud
          </div>
        
        powered by
        <a href="https://leancloud.cn">LeanCloud</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>